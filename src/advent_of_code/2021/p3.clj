(ns advent-of-code.2021.p3
  (:require [clojure.string :as str]))

(def example "00100\n11110\n10110\n10111\n10101\n01111\n00111\n11100\n10000\n11001\n00010\n01010")
(def input "011001101000\n010101111100\n000000111101\n001001001010\n010011000001\n111111001110\n001011101111\n110011010110\n100011111110\n101110000111\n000011011100\n001111111011\n011101001111\n111001010110\n011100011110\n001011000010\n100010111011\n000101010011\n000001101100\n010001011110\n100010101000\n111101011101\n110000100001\n011011010101\n110101100110\n001101101010\n111010110011\n011111111000\n010001010001\n000001010101\n001001011011\n101111110011\n100011010001\n111010010111\n011010011010\n101111011011\n101010111100\n001111100110\n010100110111\n010110101100\n000111110101\n111110101110\n111010000000\n011111111010\n000101011100\n000001010110\n101000100101\n100001011001\n011101110010\n110111100100\n110011001011\n000010001111\n000100010101\n110111001100\n010001100000\n101111110101\n111000011011\n000100001001\n101101011101\n001001011110\n101100111010\n011011000010\n110010010111\n101001010101\n000000101110\n000011011111\n010001000011\n011011001010\n101101111011\n100010001010\n001001011100\n010011110001\n000001111101\n100001000101\n011101011010\n000010101110\n001010101010\n101010011011\n000111001011\n000011101000\n110100101001\n000111111010\n100111100101\n111010001111\n111100110001\n011111101010\n110101000011\n001111101100\n101000100110\n100101100011\n000011010011\n010101011111\n010000110111\n110011001001\n101011011101\n001011100001\n000001100101\n001001001101\n001101001111\n001110110001\n010110101110\n001100110110\n001000001111\n101101001001\n011111011010\n111111101110\n111001100000\n100101011001\n010101100101\n100000110100\n011001001000\n111100110011\n111011110001\n110011111010\n001101001010\n111110011111\n110101100000\n111001000101\n010001111110\n111011010100\n110011010111\n100100110111\n111111011010\n011110101111\n001011110010\n010111011010\n011101101101\n011010101110\n011000110001\n010110101010\n011110010000\n111111011100\n111011000101\n100110101110\n010101100010\n101100011110\n000010110101\n010010011110\n110000000110\n011111010101\n000110110011\n101011000010\n000011000111\n101011010000\n101101101001\n010000101010\n101001001001\n111010110110\n111000111101\n000001010111\n101110001100\n110010110001\n100000110001\n101100101011\n100000111001\n010110100111\n101011001111\n101010111001\n010010110000\n001110010011\n010101101110\n011000010100\n100111111000\n011110100011\n110100100111\n101110101000\n101010101111\n101001000000\n111010000110\n101001000100\n010001100111\n011011010001\n000101010101\n010110000011\n100000101110\n110010001000\n111000100001\n001001101001\n110010001001\n100001111011\n101010010100\n110011100101\n010101100001\n011101010100\n110100101111\n110100001111\n011000101101\n001011101100\n010010010101\n011011111010\n010101000001\n100101100000\n101001111101\n010000000100\n110000110100\n000000001101\n100100111101\n111100110010\n001011001111\n101100001011\n001111010001\n101100011001\n100110110001\n010111000011\n011010110101\n100111100011\n000111110011\n010101111101\n010010000000\n011000011011\n001100011001\n001011001001\n101110101101\n101111110111\n101011100100\n000100110100\n110000101111\n011001111101\n000000000111\n111001001010\n110100001100\n000001001110\n111001101011\n100011011111\n110000001000\n110101011011\n001010000101\n001011111001\n011011111100\n010100110101\n110101111001\n010110010101\n010010001000\n001001110111\n011111111111\n100011100010\n000110001101\n011111010000\n010111110010\n110010100011\n101011110101\n110011011110\n010000000101\n011101100100\n110010011100\n011101101100\n000010001001\n000011101101\n000101100011\n010111111000\n010111100111\n010101000101\n110111100010\n110001101011\n111010100000\n101010101011\n011101010101\n000100110111\n000111100111\n000100111111\n111100001001\n010000100001\n110101011111\n100010000100\n000011011000\n111011110000\n101000011100\n110001001010\n001000010101\n110110000101\n100000011110\n001101111010\n010111001100\n111011111100\n100101001000\n010111101001\n110010010000\n110011010000\n000010100111\n100101111101\n110101100010\n110100011110\n101111010110\n110001001111\n011101000111\n001011001101\n110001000010\n011110100110\n000101100110\n000110111110\n001010111010\n100110000111\n001000010110\n100001110100\n000111000110\n101100011100\n110100110110\n100011010111\n000101110001\n001010010110\n101000000101\n100101101000\n000111111110\n010010010111\n110010001010\n001100110111\n110110110101\n011111011101\n110101100111\n100100100111\n011011000000\n111101001100\n011101000011\n011101001010\n101101101101\n100100110010\n001000000010\n010010001010\n111110111001\n000111010001\n011100111111\n011111011001\n110101000000\n011110000010\n001111010110\n010011111111\n110101111011\n101110111111\n001001100001\n011100111100\n110111001110\n011000000111\n001100010111\n001011010010\n010010001011\n101110000011\n100000101000\n100010100100\n000111011101\n001000111011\n010010101010\n111011010011\n110100010001\n011110001110\n111010110001\n010000010111\n010110101101\n111101100001\n110011100110\n000101111110\n110010101010\n000001010000\n001101111101\n011011110100\n110001010101\n011001000001\n001101101100\n100011011011\n101011100010\n011011100101\n100110110101\n110111001011\n000100101011\n001101010100\n010000011100\n101100111011\n011001011100\n011011010100\n011100110001\n010010110011\n101000110011\n111101010001\n111000000100\n101101100111\n001011111000\n010100000111\n011110101101\n111011101100\n110101110001\n001110010000\n010010000111\n101001111011\n100100111100\n000101101101\n101111110100\n100000101111\n011001110000\n011110011001\n000101010110\n000000000101\n110010001100\n000111100100\n010010011010\n001111110100\n011010001010\n101100101111\n011001001011\n100011111101\n101100000001\n100100101010\n000000000100\n111001110101\n000010011110\n110110100100\n111010010001\n011101010010\n011100101111\n010110000010\n010000110101\n110101010011\n001110011110\n111010011010\n000110101000\n001111000001\n010110110000\n001100110001\n110011011111\n000100111011\n110001000111\n011010111101\n000010100110\n010100101001\n010001000010\n000101110101\n101100110100\n111000110010\n111011110010\n010111001111\n100000101101\n101100001010\n100100001001\n111111111101\n001010101001\n000011011010\n101011010010\n111001000110\n111100010011\n111010011100\n100000111100\n011100001101\n110001101000\n101111011001\n001100001000\n101110010111\n011111100000\n001011100000\n101011101010\n110010101111\n001110000101\n001111011011\n011110101000\n111000001000\n010100111010\n010010111001\n110000110001\n110011000101\n001110000100\n010100101101\n101010110100\n100001010100\n100011010011\n100000010010\n011101010111\n001000010111\n001100111100\n000110100011\n101111101010\n010001010000\n001100100110\n111001111110\n101000001001\n000010110010\n110111101011\n101011000011\n001000111111\n100011001101\n011010010101\n110011100011\n110010011010\n110001010100\n100010111101\n101110000110\n010111001011\n110011011100\n110001100011\n000100011010\n111011100010\n011110110011\n011111100010\n000100001101\n100010010000\n110000000011\n101001011000\n101100110101\n001010101011\n011001011010\n001010001001\n001111011100\n111100010001\n100011010110\n001000110111\n011011010011\n001100000000\n100001111100\n000011110101\n100010000111\n000010110011\n000010111110\n011110000101\n010000001011\n001111110010\n001110001001\n011101111111\n010110110001\n110000000111\n010101011101\n010111001001\n100100010010\n101001101110\n100001001010\n010001011101\n100111010101\n100000101011\n000100101001\n110111001001\n100100000001\n010111010010\n111101111011\n011010010010\n111101101000\n100110111101\n010010001001\n100111011000\n110101111111\n111010101110\n010011110010\n101001100100\n010000101111\n010011001111\n110010011111\n101110100111\n011010100101\n111111001001\n010101100110\n101001001101\n001000101010\n010001001100\n101001101000\n110110100000\n011101000101\n100101010101\n101110111011\n010010101001\n110100011000\n110101111010\n110000100000\n010011101101\n111011001101\n100100011101\n110100010111\n011100110100\n010111011001\n011101010001\n101000000010\n100111111001\n100100001000\n001000001000\n001000000100\n011110110010\n010101010011\n101101101100\n110111111001\n010000010011\n100010100001\n000110101111\n101010101101\n100101111100\n000111010110\n001101101111\n110010000011\n110100001110\n011111111101\n111011010101\n001010100010\n100010100110\n101101110111\n010110011011\n111001110110\n011110101001\n110011100111\n000100111101\n101100011000\n101101001010\n011111100111\n010000011000\n100001100110\n000000101101\n000111010010\n110000001100\n111111101010\n001000100010\n111111111011\n001011100111\n000101110010\n010111110011\n010000011001\n111001111101\n110100001101\n010001101000\n110000101011\n011011000110\n110010111011\n100111101010\n011001101011\n001101010011\n011000100101\n110111101111\n001000100001\n010010111101\n101101101011\n011111011100\n111111010110\n001110000000\n101011110010\n011101011111\n001001101101\n011101110000\n011100011101\n111101001101\n010111010101\n010111101010\n001000101101\n100000000011\n111110101111\n000111101111\n001110010101\n101111001101\n111100110000\n110010100000\n011101110100\n100011001111\n010110001001\n111100101100\n101001110100\n011010010111\n011000100100\n001100110100\n001001111000\n001000000111\n110100000111\n011000001011\n001011000000\n110110110111\n000010111011\n001001000011\n000011100111\n110011001111\n010000111101\n001110100010\n000011110001\n011001111011\n110111000001\n111111000001\n011001100110\n110010101100\n111101010100\n010010000101\n000011011011\n110110010001\n010111111010\n010000010101\n110000011010\n110001101110\n000110101011\n101111000111\n001101100000\n010100000001\n111110001001\n000011110000\n111100111001\n000001001011\n011000010110\n000001000100\n011100111000\n001011111110\n011100000000\n000101001011\n111111110110\n111010011000\n001000111101\n011001110010\n001101011100\n100110001111\n110110111010\n001110101100\n010000101100\n010011000011\n100101110010\n000000111010\n000001111001\n111101011000\n101000011001\n111110000101\n101111111011\n100110111110\n000110010110\n011011101110\n100000010111\n110111001000\n000010101010\n001010011011\n101010101010\n101100000000\n000101101011\n010110100110\n110010010100\n001010110101\n001110000001\n010001101010\n111111110100\n001101110110\n111101010111\n101011101100\n110001101010\n100111010100\n101101111001\n001011100110\n010010001111\n100101110110\n110011000010\n001111010100\n000101011011\n110000000001\n011011001001\n001001011111\n000111011111\n100001001100\n111011010010\n010101011001\n000001110100\n000010100101\n110110010010\n100010111110\n011110111110\n000001101000\n001011000110\n000010001010\n101101010100\n011011010000\n000011111000\n101000001110\n011110101011\n110100111000\n000011000010\n111111010001\n011101110001\n100000111101\n110100101101\n110000100101\n011001110110\n110001010010\n010010110110\n011110001000\n111010110100\n101111110010\n110000110111\n111101110100\n110111101110\n100110010111\n001001100011\n001110111000\n101110100100\n010000101101\n010111100101\n011001100010\n011100000101\n101001111001\n100011001010\n100010000010\n100101000010\n111111100101\n100001101110\n101001010110\n100000100011\n100000011000\n000110000001\n000000011011\n011000110101\n011010111011\n111110000001\n001001110100\n001011011110\n110111010110\n011101110101\n101111000101\n100001010010\n000001111000\n001110010100\n111111101100\n001011010001\n111001111001\n100101101010\n111000000010\n010101001010\n001010000010\n101011000110\n110011001010\n001000011000\n001010010011\n110000111101\n001001100000\n111101100111\n011001001100\n001100111011\n100001010101\n111010100011\n111000011111\n001000000000\n101110011001\n000000000011\n111011000111\n011010100011\n110000110000\n000011001001\n011000010001\n011110000011\n011101000000\n010100110011\n010110010001\n111001101111\n110111110100\n110111110110\n100111001011\n111100110110\n101010001110\n100110000010\n011011100001\n001101010010\n010001110011\n010011110000\n110010100111\n001101110100\n101010101100\n110000111000\n011101110110\n101011110001\n110011000000\n010000011011\n001011010000\n010111010001\n010100010101\n110101000100\n010011101011\n010110111001\n101111000011\n011011100000\n000010100010\n001100110000\n110000111001\n100100100000\n001101000010\n100000010011\n100010011110\n110101010000\n000100000101\n000111000001\n000001111011\n100111011101\n110111110111\n011101111000\n001001000110\n100110010011\n100011100111\n010011010000\n010011010111\n001101100101\n010000010110\n000101010001\n011111010100\n010010111100\n001010101110\n110000001011\n011001010101\n000001111110\n010111111011\n011110010010\n001001101100\n101100101000\n100000001110\n110001001110\n011110111011\n001000110011\n111100110111\n001101100111\n000110110000\n000010011011\n100110111010\n111110001100\n000000101100\n110000111100\n100110111100\n110111111100\n110000111010\n100001100100\n100010011010\n011011100110\n110100010110\n001001010101\n000110101110\n101001100000\n100010110011\n111000001101\n101110100110\n100010111100\n000101110110\n000011011001\n000001010100\n101100111001\n011101111101\n011110011000\n111010001011\n010101110101\n100001100101\n100110100010\n100110011000\n001010100110\n011001010111\n111111001010\n111111001000\n111110100101\n000101000011\n110101101111\n110100010010\n011100000010\n001000010100\n101100000111\n001010111111\n101001010011\n101011001000\n001100000011\n010010101000\n101101111101\n101001010010\n100101111011\n101110101110\n100000100100\n000000000010\n011101100011\n110000110110\n101000110000\n111011111010\n010111000110\n001111110110\n100111110110\n100110011101\n000000001000\n101110111010\n000101011000\n001011100011\n011101100111\n000011000011\n000101011001\n110101101101\n101000001111\n111000010101\n000011100010\n011010111001\n001100100101\n010111111101\n010101111011\n000101001100\n101010000111\n111100111111\n100000000111\n110111110011\n000110110111\n010011011111\n100110010100\n000100111110\n001000111001\n011111000001\n001010100101\n101010001100\n011100001011\n000101001111\n010010101111\n101000111011\n001101000001\n100100100001\n100010101111\n100111111110\n011011111001\n101000000001\n111001101101\n101011010101\n111111100110\n001010010100\n011101111001\n001100100000\n101001110110")

(defn parse [input]
  (->> (str/split-lines input)
       (map #(str/split % #""))))

(defn most-frequent [coll]
  (->> (frequencies coll)
       (sort-by val)
       (last)
       (first)))

(defn invert-str [value]
  (str/join (map {\1 \0 \0 \1} value)))

(defn part-1 [input]
  (->> (apply map vector input)
       (map most-frequent)
       (str/join)
       ((juxt identity invert-str))
       (map #(Integer/parseInt % 2))
       (reduce * 1)))

(defn frequency [offset coll]
  (->> (map #(get % offset) coll)
       (frequencies)
       (sort-by val)))

(defn most-common-frequent [offset coll]
  (let [[least common] (frequency offset coll)]
    (if (= (second least) (second common))
      "1"
      (first common))))

(defn least-common-frequent [offset coll]
  (let [[least common] (frequency offset coll)]
    (if (= (second least) (second common))
      "0"
      (first least))))

(defn same-bit? [offset expected-bit bits]
  (= expected-bit (get bits offset)))

(defn filter-part-2 [f offset coll]
  (if (= 1 (count coll))
    (first coll)
    (let [expected-bit (f offset coll)]
      (recur f
             (inc offset)
             (filterv (partial same-bit? offset expected-bit) coll)))))

(defn part-2 [input]
  (->> [(filter-part-2 most-common-frequent 0 input)
        (filter-part-2 least-common-frequent 0 input)]
       (map str/join)
       (map #(Integer/parseInt % 2))
       (reduce * 1)))

(comment

  (part-1 (parse example))
  (part-1 (parse input))
  (part-2 (parse example))
  (part-2 (parse input)))
